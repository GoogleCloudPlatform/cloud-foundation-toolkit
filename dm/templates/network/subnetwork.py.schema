# Copyright 2018 Google Inc. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

info:
  title: Subnet
  author: Sourced Group Inc.
  version: 1.0.0
  description: |
    Creates a subnetwork.

    For more information on this resource:
      - https://cloud.google.com/vpc/docs/vpc

    APIs endpoints used by this template:
    - gcp-types/compute-v1:subnetworks =>
        https://cloud.google.com/compute/docs/reference/rest/v1/subnetworks/insert

additionalProperties: false

required:
  - network
  - region
  - ipCidrRange

properties:
  name:
    type: string
    description: |
      The name of the resource, provided by the client when initially creating the resource. The name must
      be 1-63 characters long, and comply with RFC1035. Specifically, the name must be 1-63 characters long and
      match the regular expression [a-z]([-a-z0-9]*[a-z0-9])? which means the first character must be a lowercase
      letter, and all following characters must be a dash, lowercase letter, or digit, except the last character,
      which cannot be a dash.
      If not specified, the DM resource name is used.
  project:
    type: string
    description: |
      The project ID of the project containing the Cloud Router instance. The
      Google apps domain is prefixed if applicable.
  network:
    type: string
    description: |
      The URL of the network to which the subnetwork belongs. For example:
        - projects/<project_name>/global/networks/<network_name>
  region:
    type: string
    description: The name of the region where the subnetwork resides.
  ipCidrRange:
    type: string
    pattern: ^([0-9]{1,3}\.){3}[0-9]{1,3}\/[0-9]{1,2}$
    description: |
      The range of internal addresses owned by the subnetwork.
      Ranges must be unique and non-overlapping within a network.
      Only IPv4 is supported. For example, 10.0.0.0/8 or 192.168.0.0/16.
  privateIpGoogleAccess:
    type: boolean
    default: true
    description: |
      Defines whether the VMs in this subnetwork can access Google services 
      without assigned external IP addresses. This field can be either set at the 
      resource creation time or updated using setPrivateIpGoogleAccess.
  secondaryIpRanges:
    type: array
    description: |
      An array of configurations for the secondary IP ranges of VM instances
      contained in this subnetwork. The primary IP of a VM must belong to the
      primary ipCidrRange of the subnetwork. The alias IPs may belong to either
      primary or secondary ranges. For example:
        - rangeName: my-secondary-range-1
          ipCidrRange: 172.16.0.0/24
        - rangeName: my-secondary-range-2
          ipCidrRange: 172.16.1.0/24
    items:
      type: object
      additionalProperties: false
      required:
        - rangeName
        - ipCidrRange
      properties:
        rangeName:
          type: string
          description: |
            The name associated with this subnetwork secondary range, used when adding an alias IP range
            to a VM instance. The name must be 1-63 characters long, and comply with RFC1035.
            The name must be unique within the subnetwork.
        ipCidrRange:
          type: string
          description: |
            The range of IP addresses belonging to this subnetwork secondary range. Provide this property
            when you create the subnetwork. Ranges must be unique and non-overlapping with all primary
            and secondary IP ranges within a network. Only IPv4 is supported.
  enableFlowLogs:
    type: boolean
    description: If "true", enables flow logging for the subnetwork.

outputs:
  properties:
    - name:
        type: string
        description: The subnet resource name.
    - selfLink:
        type: string
        description: The URI (SelfLink) of the subnet resource.
    - region:
        type: string
        description: The name of the region where the subnetwork resides.
    - network:
        type: string
        description: The URL of the network to which the subnetwork belongs.
    - ipCidrRange:
        type: string
        description: |
          The range of internal addresses owned by the subnetwork.
    - gatewayAddress:
        type: string
        description: |
          The gateway address for default routes to reach destination addresses
          outside this subnetwork.

documentation:
  - templates/network/README.md

examples:
  - templates/network/examples/network.yaml
